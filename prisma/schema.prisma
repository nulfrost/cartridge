generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  did        String   @unique
  handle     String?
  created_at DateTime @default(now())
  logs       Log[]
  reviews    Review[]

  @@map("users")
}

model Game {
  id              String    @id @default(cuid())
  name            String
  cover_art_image String?
  release_date    DateTime?
  game_studios    String[]
  platforms       String[]
  slug            String    @unique

  logs    Log[]
  reviews Review[]

  @@map("games")
}

model Log {
  id          String    @id @default(cuid())
  uri         String
  status      Status
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now())
  started_at  DateTime?
  finished_at DateTime?

  user   User   @relation(fields: [userId], references: [id])
  userId String

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  @@index([userId])
  @@index([gameId])
  @@map("logs")
}

model Review {
  id     String  @id @default(cuid())
  rating Int
  text   String?
  uri    String  @unique

  reviewer   User   @relation(fields: [reviewerId], references: [id])
  reviewerId String

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String
}

model Session {
  key     String @unique
  session String

  @@map("sessions")
}

model State {
  key   String @unique
  state String

  @@map("states")
}

enum Status {
  PLAYING
  COMPLETED
  PLANNED
  DROPPED
  ON_HOLD
}
